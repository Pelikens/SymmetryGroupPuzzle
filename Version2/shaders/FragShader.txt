// FragShader.txt

precision mediump float;

varying vec2 frag_texCoords;

uniform float permWidth;
uniform float permHeight;

uniform sampler2D mainTexSampler;
uniform sampler2D permTexSampler; // Note that I would have preferred to use a usampler2D, but it's not supported by WebGL.

float DecodeVector(in vec2 vector)
{
    float lower_part = vector.x * 255.0;
    float upper_part = vector.y * 255.0;
    return lower_part + 256.0 * upper_part;
}

void main()
{
    vec4 perm_data = texture2D(permTexSampler, frag_texCoords);
    vec2 perm_texCoords = vec2(DecodeVector(perm_data.zw) / permWidth, 1.0 - DecodeVector(perm_data.xy) / permHeight);
    gl_FragColor = texture2D(mainTexSampler, perm_texCoords);
}